#!/usr/bin/env -S mycmd myproject run
# -*- mode: shell-script; sh-shell: bash; sh-basic-offset: 4; sh-indentation: 4; coding: utf-8 -*-
# shellcheck shell=bash

set -o nounset -o errexit -o errtrace -o pipefail

# --------------------------------------------------------------------------------------------------
# Bash Script Related Tasks
myproject.register_task_definition_file_description "Tasks related to the Bash scripts in my dot files project"

mycmd.defer_at_startup mycmd.init_bin shfmt
function format_shell_files() {
    local -n format_fileset="${1}"

    if myproject.is_verbose_enabled; then
        mycmd.output "Formatting the following files:"
        myproject.list_files "${!format_fileset}"
    fi

    mycmd.bin_execute shfmt --language-dialect bash --indent=4 --binary-next-line --case-indent --write "${format_fileset[@]}"
}

myproject.register_task_with_fileset format format_shell_files ALL_BASH_SCRIPTS
myproject.register_task_description format "Format all Bash script source files with shfmt."

mycmd.defer_at_startup mycmd.init_bin shellcheck
function lint_shell_files() {
    local -n lint_fileset="${1}"

    if myproject.is_verbose_enabled; then
        mycmd.output "Linting the following files:"
        myproject.list_files "${!lint_fileset}"
    fi

    myproject.output_only_if_not_quiet "Running ShellCheck:"

    mycmd.bin_execute shellcheck --check-sourced "${lint_fileset[@]}"
}

myproject.register_task_with_fileset lint lint_shell_files ALL_BASH_SCRIPTS
myproject.register_task_description lint "Lint all Bash script source files with shellcheck."

mycmd.trace "Finished loading the Bash scripts task definition file."
